$(function(){var a=new ClearHistory();a.init();});function ClearHistory(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}ClearHistory._CONS_={EDIT_URL:ctx+"/gl/clear/clearHistory/edit.htm",DETAIL_URL:ctx+"/gl/clear/clearHistory/detail.htm",DELETE_URL:ctx+"/gl/clear/clearHistory/delete.htm",SAVE_ADD_URL:ctx+"/gl/clear/clearHistory/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/clear/clearHistory/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/clear/clearHistory/listData.htm",EDIT_FORM_ID:"clearHistoryForm",GRID:"#clearHistoryGrid",PAGER:"#clearHistoryPager"};
ClearHistory.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initSelect();this._bindEventHander();this._csMap=new Map();this._reloadData();
}},_reloadData:function(){var a=ctx+"/gl/clear/clearHistory/listData.htm";FormUtils.loadData(a,function(c){if(c&&c.length){var d=$.templates("#clearHistoryDivTmpl");
var b=d.render(c);$("#clearHistoryContainer").empty().append(b);}else{$("#clearHistoryContainer").empty();}},null,false);},_delete:function(c){var a=this;
var b={};b.ids=c;DialogUtils.confirmWithOptions({title:"删除历史记录吗?",text:"删除后将再也无法恢复记录,请谨慎操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/delete.htm",b,function(d){if(d.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});},_clearHistoryData:function(c){var a=this;
var b={};b.ids=c;DialogUtils.confirmWithOptions({title:"删除备份记录吗?",text:"删除后将再也无法恢复记录,请谨慎操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/deleteHistoryData.htm",b,function(d){if(d.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});},_revertData:function(c){var a=this;var b={};
b.ids=c;DialogUtils.confirmWithOptions({title:"恢复此次记录删除的数据吗?",text:"只能恢复一次!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/revertHistory.htm",b,function(d){if(d.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});},_initSelect:function(){var a=this;a._initEmployeeSelect(undefined,$("#clearCsEmployeeSelector"));
a._initEmployeeSelect(undefined,$("#clearCsEmployeeSelector4SoClear"));a._initEmployeeSelect(undefined,$("#clearSoEmployeeSelector4SoClear"));$("#clearCsBelongOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearCsBelongOrgId").val(),container:"clearCsBelongOrgName",isMultiple:true,fn:function(b){$("#clearCsBelongOrgId").val(b);
}});});$("#clearCsOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearCsOrgId").val(),container:"clearCsOrgName",fn:function(b){var c=$("#clearCsEmployeeSelector");
a._initEmployeeSelect(b,c);$("#clearCsOrgId").val(b);}});});$("#clearCsBelongOrgName4SoClear").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearCsBelongOrgId4SoClear").val(),container:"clearCsBelongOrgName4SoClear",isMultiple:true,fn:function(b){var c=$("#clearCsEmployeeSelector4SoClear");
$("#clearCsBelongOrgId4SoClear").val(b);a._initEmployeeSelect(b,c);}});});$("#clearCsOrgName4SoClear").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearCsOrgId4SoClear").val(),container:"clearCsOrgName4SoClear",fn:function(b){var c=$("#clearCsEmployeeSelector4SoClear");
a._initEmployeeSelect(b,c);$("#clearCsOrgId4SoClear").val(b);}});});$("#clearSoPlacerOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearSoPlacerOrgId4SoClear").val(),container:"clearSoPlacerOrgName",isMultiple:true,fn:function(b){$("#clearSoPlacerOrgId4SoClear").val(b);
var c=$("#clearSoEmployeeSelector4SoClear");a._initEmployeeSelect(b,c);}});});$("#clearSoOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearSoOrgId").val(),container:"clearSoOrgName",fn:function(b){var c=$("#clearSoEmployeeSelector4SoClear");
a._initEmployeeSelect(b,c);$("#clearSoOrgId").val(b);}});});},_initEmployeeSelect:function(b,c){var a=this;FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type=dept_manager",function(e){c.empty();
var f=new StringBuffer();f.append("<option value=''>请选择</option>");if(e&&e.length){for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");
}}c.append(f.toString()).select2();},null,true);},_bindEventHander:function(){var a=this;$("body").on("click",".deleteHistory",function(){var b=$(this).attr("idVal");
a._delete(b);});$("body").on("click",".clearHistoryData",function(){var b=$(this).attr("idVal");a._clearHistoryData(b);});$("body").on("click",".reverHistory",function(){var b=$(this).attr("idVal");
a._revertData(b);});$("body").on("click",".clearBtn",function(){var c=$(this).closest("form").serialize();var b=$(this);DialogUtils.confirmWithOptions({title:"确定要删除数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){b.attr("disabled",true);
FormUtils.submit(ctx+"/gl/clear/clearHistory/clearData.htm",c,function(d){b.attr("disabled",false);if(d.success){DialogUtils.success("成功","操作成功");a._reloadData();
}else{DialogUtils.error("失败",d.msg);}},function(){b.attr("disabled",false);DialogUtils.error("错误","后台异常，请稍后重试");},false);}});});$("body").on("click",".checkBtn",function(){var c=$(this).closest("form").serialize();
var b=$(this).parents("form");DialogUtils.confirmWithOptions({title:"确定检查数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/checkData.htm",c,function(d){if(d.success){b.find(".tipLabel").empty().html(new Date().current());
b.find(".tipResult").empty().html(d.msg);}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});});$("body").on("click",".clearSoByAidBtn",function(){var b=$("#clearSoByAidForm #clearSoByAidEmployeeSelector").val();
if(!b){DialogUtils.error(msgCode.error,"请选择员工");return;}var d=$("#clearSoByAidForm [name=startTime]").val();var c=$("#clearSoByAidForm [name=endTime]").val();
if(!d||!c){DialogUtils.error(msgCode.error,"请选择开始时间和结束时间");return;}var e={};e.type=$("#clearSoByAidForm").find("[name=type]").val();e.startTime=d;e.endTime=c;
e.aids=b;DialogUtils.confirmWithOptions({title:"确定要删除数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/clearData.htm",e,function(f){if(f.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",f.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});});$("body").on("click",".selectSelfCsEntity",function(){var c={type:"self",baseUrl:ctx+"/crm/cs/csEntity/list.htm?isSelectCsEntity=true",callBack:function(k,h){for(var f=0;
f<k.length;f++){var j=k[f];var g={id:j.id,code:j.pureCode,name:j.name};a._csMap.put(g.id,g);}var e=a._csMap.values();var d=a._buildCsDiv(e);$("#clearSoByCsForm #csContainer").empty().append(d);
}};var b=new SelectCsEntityService();b.init(c);});$("body").on("click",".selectMySubCsEntity",function(){var c={type:"mysub",baseUrl:ctx+"/crm/cs/csEntity/subList.htm?isSelectCsEntity=true",callBack:function(k,h){for(var f=0;
f<k.length;f++){var j=k[f];var g={id:j.id,code:j.pureCode,name:j.name};a._csMap.put(g.id,g);}var e=a._csMap.values();var d=a._buildCsDiv(e);$("#clearSoByCsForm #csContainer").empty().append(d);
}};var b=new SelectCsEntityService();b.init(c);});$("body").on("click",".removeCsDiv",function(){var b=$(this).attr("idVal");a._csMap.remove(b);$(this).parents(".csDiv-"+b).remove();
});},_buildCsDiv:function(c){var b=$.templates("#csDivTmpl");var a=b.render(c);return a;},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(ClearHistory._CONS_.EDIT_FORM_ID,a);
},};